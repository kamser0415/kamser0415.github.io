---
layout: single
title: 2025-02-27 TIL
categories: TIL) ThreadLocal에 대해서 정리해보기
tag: [Today I Learned]
toc: true
toc_sticky: true
author_profile: false
sidebar:
    nav: "docs"
search: true
sidebar:
    nav: "counts"
typora-root-url: ../
---

## 📌 2025-02-27 TIL

## 1. 오늘의 학습 주제
- 각 쓰레드마다 고유의 데이터 저장공간을 알아보자

## 2. 학습 내용

자바는 멀티쓰레드 환경에서 동작하는 프로세스입니다.



변수는 전역 변수, 지역변수, 멤버변수가 있습니다.



여기서 전역 변수는 모든 쓰레드가 공유하며 데이터를 수정할 수 있게 한다면 동시성 제어 로직이 필요합니다.

지역 변수는 메소드 내에 있는 변수로 다른 쓰레드가 수정할 수 없습니다.

이유는 쓰레드마다 고유 메모리 공간인 스택에서 관리하기 때문에 동시성 문제는 발생하지 않습니다.



하나의 쓰레드 작업동안 공용으로 사용하려는 데이터를 관리하는 방법은



1. 메서드 호출마다 전달하는 방법이 제일 먼저 생각날 거입니다.

그런데 이 방식의 문제는 객체지향 프로그래밍의 특징을 사라지게 합니다.



이유는 각 계층간 동일한 dto를 공유하게 되면 dto 변경시 모든 클래스에 영향이 가므로 확장에 불리하고 유지보수도 어려워집니다.



이걸 방지하고자 각 계층별로 사용하는 dto를 나누어 사용합니다.



그래도 모든 계층에서 공용으로 사용해야하는 경우가 있습니다.



예를 들어 커넥션이나 추적 id, 그리고 인증정보등이 여기에 해당합니다.



자바에서는 이걸 쉽게 사용하도록 로컬쓰레드를 추가했습니다.



쓰레드로컬은 모든 쓰레드에서 접근이 가능하지만, 쓰레드 내부에 있는 threadlocal의 값이 key로 사용하여 데이터를 저장 등록합니다.



aop와 같이 전역으로 필요하며 쓰레드 내에서만 고유성있게 사용하려는 변수를 저장하고 사용하는 것을 말합니다.
