---
layout: single
title: TIL) í•„í„°, ì¸í„°ì…‰í„°ì—ì„œ ê³µë¶€í•˜ë‹¤ê°€ ì•Œê²Œëœ ì§„ì‹¤
categories: TIL
tag: [Today I Learned]
toc: true
toc_sticky: true
author_profile: false
sidebar:
    nav: "docs"
search: true
sidebar:
    nav: "counts"
typora-root-url: ../
---

## ğŸ“Œ 2025-04-02 TIL

## ì˜¤ëŠ˜ì˜ í•™ìŠµ ì£¼ì œ
- í•„í„°ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒ ë˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ
- ì¸í„°ì…‰í„°ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒë˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ
- ì“°ë ˆë“œí’€ê³¼ ì˜ˆì™¸ì²˜ë¦¬

## í•™ìŠµ ë‚´ìš©



### í•„í„°ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

í•„í„°ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ë¥¼ ëˆˆìœ¼ë¡œ í™•ì¸í•˜ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.

ì œê°€ ê¸°ì¡´ì— ê°€ì§€ê³  ìˆë˜ í•„í„° ì²˜ë¦¬ ì´í›„ ë™ì‘ ë°©ì‹ì€ ì•„ë˜ ë°©ì‹ìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤.

`WAS` -> `í•„í„°` -> `ì„œë¸”ë¦¿`-> `ì¸í„°ì…‰í„°` -> `ì»¨íŠ¸ë¡¤ëŸ¬` ì…ë‹ˆë‹¤.

ì—¬ê¸°ì„œ í•„í„°ë‚˜, ì„œë¸”ë¦¿ì´ë‚˜ , ì¸í„°ì…‰í„°ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ë˜ëŠ” ê°œë°œìê°€ ì§ì ‘ ì˜¤ë¥˜ë¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public void errorage1(HttpRequest request){
  throw new IlligalArgmentsException("ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì²˜ë¦¬ê°€ ëœë‹¤.")
}
public void errorage2(HttpResponse httpResponse){
		httpResponse.sendError(HttpServletResponse.SC_NOT_FOUND);
}
```

ì˜ˆì™¸ë¥¼ ë˜ì§€ê²Œ ë˜ë©´ ì•„ë˜ ë¡œì§ì€ ì‹¤í–‰ë˜ì§€ ì•Šê³  ì˜¤ë¥˜ ì²˜ë¦¬ë¡œ ë„˜ì–´ ê°‘ë‹ˆë‹¤.

sendErrorì€ íŠ¸ëœì­ì…˜ ì½”ë“œë¡œ ì‘ì„±í• ë•Œ ë¡¤ë°± ì„ ì–¸í•˜ë©´ ë¡œì§ì€ ê·¸ëŒ€ë¡œ ì‹¤í–‰ê°€ëŠ¥í•˜ì§€ë§Œ ë§ˆìŠ¤í‚¹ ì²˜ë¦¬ë˜ëŠ” ê²ƒê³¼ ë™ì¼í•©ë‹ˆë‹¤.



ì˜¤ë¥˜ê°€ ë°œìƒë˜ë©´ ë°œìƒ ì§€ì ìœ¼ë¡œë¶€í„° ìŠ¤íƒ í”„ë ˆì„ì„ íƒ€ê³  ë‚´ë ¤ì˜µë‹ˆë‹¤.

> ì»¨íŠ¸ë¡¤ëŸ¬ > ì¸í„°ì…‰í„° > ì„œë¸”ë¦¿ > í•„í„° > WAS

was(ì¹´íƒ€ë¦¬ë‚˜)ëŠ” ì˜ˆì™¸ê°€ ë°œìƒë˜ê±°ë‚˜ `response`ê°ì²´ì— ì˜¤ë¥˜ ë§ˆìŠ¤í‚¹ì„ ìˆë‹¤ë©´ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ í¬ì›Œë”©ì„ í•©ë‹ˆë‹¤.

ë¬¼ë¡  í†°ìº£ì´ ì§€ì •í•œ ë°©ì‹ì´ ìˆì§€ë§Œ ì»¤ìŠ¤í…€ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```java
@Component
public class WebServerCustomizer implements WebServerFactoryCustomizer<ConfigurableWebServerFactory> {
	@Override
	public void customize(ConfigurableWebServerFactory factory) {
		ErrorPage errorPage404 = new ErrorPage(HttpStatus.NOT_FOUND, "/error-page/404");
		ErrorPage errorPage500 = new ErrorPage(HttpStatus.INTERNAL_SERVER_ERROR,"/error-page/500");
		ErrorPage errorPageEx = new ErrorPage(RuntimeException.class, "/error-page/500");
		factory.addErrorPages(errorPage404, errorPage500, errorPageEx);
	}
}
```

ì´ë ‡ê²Œ ì›¹ì„œë²„ ì»¤ìŠ¤í„°ë§ˆì´ì§•ìœ¼ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” `url`ì„ ì§€ì •í•˜ê³  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ë©´ ë©ë‹ˆë‹¤.

ê·¸ëŸ°ë° ì € ErrorPage ì²«ë²ˆì§¸ ì¸ìë¥¼ ë³´ë©´ ìƒíƒœì½”ë“œê°€ ë³´ì…ë‹ˆë‹¤.

```java
// sendError ì²«ë²ˆì§¸ ì¸ìë„ status code ì…ë‹ˆë‹¤.
httpResponse.sendError(HttpServletResponse.SC_NOT_FOUND);
```

ê·¸ëŸ°ë° ëœ¬ê¸ˆì—†ëŠ” ê±°ì§€ë§Œ status codeê°€ 200ë²ˆì€ ì •ìƒì¸ë°ë„ ì—ëŸ¬ ì²˜ë¦¬ë¡œì§ì„ íƒœìš°ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
@Override
public void doFilter(jakarta.servlet.ServletRequest request, jakarta.servlet.ServletResponse response,
  FilterChain chain) throws IOException, ServletException {
  
  HttpServletRequest httpRequest = (HttpServletRequest)request;
  HttpServletResponse httpResponse = (HttpServletResponse)response;
  
  httpResponse.sendError(HttpServletResponse.SC_OK);
}
```

ì´ë ‡ê²Œ ìš”ì²­ì„ í•˜ê³  ê¸°ë‹¤ë¦¬ë©´ ì‘ë‹µì€ ì•„ë˜ì™€ ê°™ì´ ì˜µë‹ˆë‹¤.

```java
http GET http://localhost:8080/api/hello
HTTP/1.1 200 
Connection: keep-alive
Content-Type: application/json;charset=ISO-8859-1
Date: Wed, 02 Apr 2025 14:23:46 GMT
Keep-Alive: timeout=60
Transfer-Encoding: chunked

{
    "error": "OK",
    "path": "/api/hello",
    "status": 200,
    "timestamp": "2025-04-02T14:23:46.124+00:00"
}
```

ì˜¤ë¥˜ë¼ê³  ì§€ì •í•˜ê²Œ ë˜ë©´ ì˜¤ë¥˜ ê°ì²´ì— ì–‘ì‹ì— ë§ëŠ” ë°˜í™˜ ê°’ê³¼ ì½”ë“œë¥¼ ë§Œë“¤ì–´ì„œ ì‘ë‹µí•˜ê²Œ ë©ë‹ˆë‹¤.

### ì¸í„°ì…‰í„°ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒë˜ëŠ” ê²½ìš°

```java
@Override
public boolean preHandle(HttpServletRequest request, HttpServletResponse
  response, Object handler) throws Exception {
  String requestURI = request.getRequestURI();
  String uuid = UUID.randomUUID().toString();
  request.setAttribute(LOG_ID, uuid);
  //@RequestMapping: HandlerMethod
  //ì •ì  ë¦¬ì†ŒìŠ¤: ResourceHttpRequestHandler
  if (handler instanceof HandlerMethod) {
    HandlerMethod hm = (HandlerMethod) handler; //í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.

  }
  log.info("REQUEST [{}][{}][{}]", uuid, requestURI, handler);
  response.sendError(HttpServletResponse.SC_OK);
  return true; //false ì§„í–‰X
}
```

ë˜‘ê°™ì´ í˜¸ì¶œì´ ë©ë‹ˆë‹¤.

```java
http GET http://localhost:8080/api/hello
HTTP/1.1 200 
Connection: keep-alive
Content-Type: application/json
Date: Wed, 02 Apr 2025 14:38:03 GMT
Keep-Alive: timeout=60
Transfer-Encoding: chunked

{
    "error": "OK",
    "path": "/api/hello",
    "status": 200,
    "timestamp": "2025-04-02T14:38:03.634+00:00"
}
```

### í•„í„°ì™€ ì¸í„°ì…‰í„°ì˜ ì°¨ì´

+ í•„í„°ëŠ” ì„œë¸”ë¦¿ ìŠ¤í™ì— ì†í•©ë‹ˆë‹¤. ì£¼ë¡œ ìš”ì²­/ì‘ë‹µì˜ ì „ì²˜ë¦¬(ì¸ì½”ë”©, ë¡œê¹…, ì¸ì¦ ë“±)ì— ì‚¬ìš©ë˜ê³ , ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCì— íŠ¹í™”ë˜ì–´ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „/í›„ì— ì„¸ë°€í•œ ì œì–´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
+ í•„í„°ëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ë ˆë²¨ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ wasê°€ ì§ì ‘ ê°œì…í•˜ê²Œ ë©ë‹ˆë‹¤.
+ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ì˜ `DispatcherServlet` ë‚´ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ `ExceptionHandler`ì™€ ê°™ì€ ìŠ¤í”„ë§ ì „ìš© ì˜ˆì™¸ ì²˜ë¦¬ê°€ ë¨¼ì € ë™ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

wasëŠ” ì˜¤ë¥˜ê°€ ë°œê²¬í•˜ë©´ `/error` ì£¼ì†Œë¡œ í¬ì›Œë“œë¥¼ í•œë‹¤.

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ê¸°ë³¸ ì—ëŸ¬ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì˜ˆì™¸ í¬ë§·ì„ ë§Œë“¤ì–´ì„œ ë°˜í™˜ì„ í•œë‹¤.

ì´ë•Œ ìµœì´ˆ ì‚¬ìš©ìì˜ urlì„ `coyoteRequest` ê°ì²´ë¥¼ í†µí•´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.



ê·¸ëŸ¬ë©´ wasê°€ ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ì € ë°©ì‹ì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

```java
@Component
public class WebServerCustomizer implements WebServerFactoryCustomizer<ConfigurableWebServerFactory> {
	@Override
	public void customize(ConfigurableWebServerFactory factory) {
		ErrorPage errorPage404 = new ErrorPage(HttpStatus.NOT_FOUND, "/error-page/404");
		ErrorPage errorPage500 = new ErrorPage(HttpStatus.INTERNAL_SERVER_ERROR,"/error-page/500");
		ErrorPage errorPageEx = new ErrorPage(RuntimeException.class, "/error-page/500");
		factory.addErrorPages( errorPage404, errorPage500, errorPageEx);
	}
}
```

wasì—ì„œ ì˜¤ë¥˜ë¡œ dispatcherRequestë¥¼ í• ë•Œ ë‘ë²ˆì§¸ ì¸ìë¡œ ìš”ì²­í•˜ê²Œ ë©ë‹ˆë‹¤.

### í†°ìº£ ì“°ë ˆë“œí’€ì— ëŒ€í•´ì„œ

í†°ìº£ì€ ì“°ë ˆë“œí’€ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì‚¬ìš©ìì˜ ìš”ì²­ì¼ ì˜¬ë•Œë§ˆë‹¤ ì“°ë ˆë“œí’€ì—ì„œ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ í˜¸ì¶œí•˜ì—¬ ì†Œì¼“ì—ì„œ ìš”ì²­ ê°ì²´ì™€ ì‘ë‹µ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•©ë‹ˆë‹¤.

```java
// í†°ìº£ ì‹œì‘ ì‹œ (ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”)
ServletContainer container = new ServletContainer();
container.initialize(); // ì„œë²„ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰

// ìš”ì²­ ì²˜ë¦¬ ì‹œ
executor.execute(() -> {
    container.process(request, response); // ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
});
```

ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ(ì¹´íƒ€ë¦¬ë‚˜)ëŠ” í†°ìº£ ì„œë²„ê°€ ì‹œì‘ë  ë•Œ í•œ ë²ˆ ì´ˆê¸°í™”ë˜ë©°, ê·¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ì“°ë ˆë“œ í’€ì˜ ê° ì“°ë ˆë“œì—ì„œ ì¬ì‚¬ìš©ë©ë‹ˆë‹¤.

ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### ì •ë¦¬

í•„í„°ì™€ ì¸í„°ì…‰í„°ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ wasê°€ ì˜ˆì™¸ì— ëŒ€í•œ ê°’ì„ ë°˜í™˜í•´ì¤€ë‹¤.





