---
layout: single
title: TIL) 불변객체와 GC는 무슨 관계일까
categories: TIL
tag: [Today I Learned]
toc: true
toc_sticky: true
author_profile: false
sidebar:
    nav: "docs"
search: true
sidebar:
    nav: "counts"
typora-root-url: ../
---

## 📌 2025-02-26 TIL

## 1. 오늘의 학습 주제

+ stop the world를 알아보니 불변객체가 중요하네

## 2. 학습 내용

### Stop the world를 왜 알아야할까?
자바의 특징은 메모리 관리를 개발자가 하지 않고 GC가 합니다.
GC가 메모리를 정리할 때 **쓰레드간 참조 일관성**을 위해서 잠시 소등하는 것을 우리는 STW라고 합니다.

STW를 알아야하는 이유를 생각해봤습니다.

1. 멀티 쓰레드에서 사용하지 않는 메모리를 어떻게 안전하게 정리를 할까
2. 우리 서비스가 응답 지연이나 처리량이 낮다는데 원인이 뭘까

JVM 프로세스에서 코드 영역, 데이터 영역, 힙 영역은 공용으로 사용하고 스택은 개별 쓰레드가 사용합니다.

GC는 공용으로 사용하며 동적으로 할당된 메모리를 저장하는 힙 영역의 청소를 맡고 있습니다.

개발자가 직접하지 않고 GC가 메모리를 청소하는 과정에서 발생되기에 어떤 방식으로 처리하는지 알고 있어야 한다고 생각합니다.

그래야 문제가 발생했을 때 원인 후보로 넣을 수도 있으니까요



### STW는 왜 길어는 건가

메모리를 정리하려면 사용하지 않는 메모리를 찾아야 합니다.

저는 힙 메모리는 대형 유치원이라고 생각합니다.

아이들(쓰레드)가 장난감(동적 메모리 공간)을 방(힙 메모리)에 뿌리고 갑니다.

유치원 선생님(GC)가 돌아다니며 아이들에게 물어봅니다.

> 이거 정리해도 되는거지?

장난감 방이 크면 클수록 아이들이 뿌리고 다닌 장난감을 찾아다니는 시간도 길어지는 것처럼 
힙 메모리 공간이 크면 클 수록 STW의 시간도 길어집니다.



두 번째는 장난감이 서로 관계가 있다고 생각해봅시다

변신 합체로봇인데 다리 부분, 팔 부분, 머리 부분이 있어야합니다. 이거 하나는 입구에, 다른 하나는 저 끝에 있고 이 변신 합체로봇이 복잡하면 복잡할 수록 유치원 선생님은 하나 하나 아이들이 쓰는지 , 합체에 필요한건지 확인하는 과정이 생깁니다.



세번째는 야외로 유치원 생이 외부로 나간 경우입니다.

유치원 생이 야외에 미끄럼틀을 타기 위해서 외부 놀이기구(JNI)로 갔다면 유치원 선생님은 방 안에서 돌아오기 까지 기다리는 과정이 생깁니다.



